<head>
  <title>people</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#000">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link rel="stylesheet" 
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Nunito:ital,wght@1,700&family=Patrick+Hand&family=Quicksand:wght@700&display=swap">
  <style>
@import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@600&display=swap');
</style>
  <style>
    *{
      font-family: 'Poppins';
      }
    #theme1{
      color: #000;
      }
     #theme2{
      color: pink;
    }
    body{
      padding:0;
      margin:0;
      }
  button {
  padding: 10px;
  border: none;
  border-radius: 15px;
transition: all ease 0.21s;
  }
    img{
      border-radius: 100%;
      }
  #theme1 button {
  background-color: rgb(0,0,0);
  }
  #theme1 button:active {
  background-color: rgb(22,122,222,0.1);
  }
  #theme2 button {
  background-color: rgb(215,150,150);
  }
  #theme2 button:active {
  background-color: rgb(222,192,192,0.2);
  }
    #menu{
      width: 100vw;
      height: 48px;
      align-items: stretch;
  position: fixed;
  bottom: 0;
  display: flex;
  overflow: hidden;
  flex-direction: row;
  flex-wrap: nowrap;
      border-top: solid;
      }
    #menu button {
      min-width: 25vw;
      }
    #issyoo{
      font-family: 'Dancing Script', cursive;
      padding: 10px;
      font-size: 25px;
      font-weight:900;
      position: absolute;
      right: 10px;
      }

    #nav{

  box-shadow: 2px 2px 2px rgb(0,0,0,0.2);

  height: 100vh;

  width:0;

  position: fixed;

  padding-top: 30px;

  top: 0;

  left:0;

  transition: width ease 0.21s;

  overflow-x: hidden;

}

#theme1 #menu {

      background-color: rgb(235,242,255);

      }

    #theme2 #menu{

      background-color: rgb(255,234,235);

      }

    #theme1 #menu button{

      color: rgb(22,129,222);

      }

    #theme2 #menu button{

      color: rgb(255,199,199);

      }

#dash{

  -webkit-appearance : none

}

[for = 'dash']{

  position: absolute;

  z-index: 2;

  border-radius: 100%;

}

    #nav button {

      width: 180px;

      border-radius: 0 25px 25px 0;

      box-shadow: 2px 2px 2px rgb(0,0,0,0.2);

      }

    #explore_field{

      position: absolute;

      bottom: 50px;

      width: 90vw;

      margin-left: 2vw;

      height: 35vh;

      border: solid 1px;

      border-radius: 15px;

      overflow: scroll;

      }

    #explore div:active {

      background-color: rgb(0,0,0,0.1);

      }
#progg{

  height: 2px;

  width: 10vw;

  position: absolute;

  top:0;

  left:0;

  background-color:red;

  animation: load 3s infinite;

}

    #theme1 #progg{

      background-color: blue;

      }

    #theme2 #progg{

      background-color: red;

      }

@keyframes load{

  from{left:0}

  to{left:90vw}

}
    .namebox{
      background-color: #fff;
      font-weight: 900;
      border: none;
      padding: 7px;
      text-align: center;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: solid;
      }
     .namebox span{
      font-size: 19px;
      font-weight: 700;
      }
      .namebox button {
      background-color: #000;
      box-shadow: 3px 3px 5px rgb(0,0,0,0.3);
      color: #fff;
      }
    #viewer{
      margin: auto;
      position: absolute;
      left: 0;
      right:0;
      top:0;
      bottom:0;
      height: 315px;
      width:280px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      }
   #viewer img{
    height: 70px;
    width: 70px;
}
  </style>

</head>

<body>
<div id="progg"></div>
  <button id="back" onclick="history.back()" class="material-symbols-outlined">arrow_back</button>
  <div id="explore"></div>
  </body>


 <script type="module">

  // Import the functions you need from the SDKs you need

  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-app.js";

  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-analytics.js";

  // TODO: Add SDKs for Firebase products that you want to use

  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration

  // For Firebase JS SDK v7.20.0 and later, measurementId is optional

  const firebaseConfig = {

    apiKey: "AIzaSyAN-X9u7n7QnM8RLrVV4YnXq2MmVz6WNfw",

    authDomain: "em-issyoo.firebaseapp.com",

    projectId: "em-issyoo",

    storageBucket: "em-issyoo.appspot.com",

    messagingSenderId: "33480809995",

    appId: "1:33480809995:web:74df1e056f7638d0b5310e",

    measurementId: "G-C64NWHRT0Y"

  };

  // Initialize Firebase

  const app = initializeApp(firebaseConfig);

  const analytics = getAnalytics(app);

  

  import{

      getFirestore,Timestamp , doc, getDoc, getDocs, limit, orderBy, query, where, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField, onSnapshot, arrayUnion

  }from "https://www.gstatic.com/firebasejs/9.9.3/firebase-firestore.js";

  import { getAuth, signInWithPopup,signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider , signOut

  } from "https://www.gstatic.com/firebasejs/9.9.3/firebase-auth.js";
 
  const auth = getAuth();

  const db = getFirestore();

//import { collection, getDocs } from "firebase/firestore";

async function getRequested(){

  var uid = sessionStorage.getItem("uid");
const request= [];
const q = query(collection(db, "Proposals"), where("Uid", "array-contains", uid), where("Status", "==", 'pending'));
const querySnapshot = await getDocs(q);
querySnapshot.forEach((doc) => {
  // doc.data() is never undefined for query doc snapshots
  console.log(doc.id, " => ", doc.data());
  if(doc.data().Uid[0] == uid){
  request.push(doc.data().Uid[1]);
  }
  else{
  request.push(doc.data().Uid[0]);
  }
});

/*  var querySnapshot = await getDocs(query(collection(db, "Private"),where("RecieverUid", "==", uid)));

querySnapshot.forEach((doc) => {

  // doc.data() is never undefined for query doc snapshots

request.push(doc.data().SenderUid);

  console.log(doc.id, " => ", doc.data().SenderUid);

});*/

  Check_login_data(request);

}

getRequested();

      async function Check_login_data(request){

var uid = sessionStorage.getItem("uid");

var q = query(collection(db, "People"), where("Uid", "==", uid));

const querySnapshot = await getDocs(q);

querySnapshot.forEach((doc) => {

  // doc.data() is never undefined for query doc snapshots

  const name = doc.data().Name;

  const email = doc.data().Email;

 // alert("Name: " + name + "\n" + "Email: " + email);

GetUsers(name, request);

});
 }

   

    

   async function GetUsers(name, request){
const q = query(collection(db, "Public"), where("Name", "!=", null), where('Type', '==', 'user'));

const querySnapshot = await getDocs(q);

querySnapshot.forEach((doc) => {

  // doc.data() is never undefined for query doc snapshots

  console.log(doc.id, " => ", doc.data());
document.getElementById("progg").hidden= true;
  var box = document.getElementById("explore");

  var namebox = document.createElement("div");
  var phto = document.createElement("img");
  if(!!doc.data().Pic){
  phto.src = doc.data().Pic;}
  else{
    phto.src = "https://firebasestorage.googleapis.com/v0/b/em-issyoo.appspot.com/o/Screenshot_2022-09-22-14-28-40-452-edit_com.android.chrome.jpg?alt=media&token=aa6e0aba-df6d-4b12-8761-6ca2cc118d2a";
    }
  namebox.appendChild(phto);
  phto.style.width = "30px";
  phto.style.height = "30px";
  namebox.setAttribute("class", "namebox");
  if(!!request[0]){

  for( let i = 0; i< request.length; i++){
  if( doc.data().Uid == request [i]){
    box.appendChild(namebox);
    console.log("breaking from request", doc.data().Uid);
    break;
  }

  else if(doc.data().Name != name){
    namebox.remove();
    console.log("appending from req ", doc.data().Uid);
  }}}

  else{
    if(doc.data().Name != name){
     //box.appendChild(namebox);
      console.log("breakink from outer");
    }}
  var namer = document.createElement("span");
  namebox.appendChild(namer);
  namer.textContent = doc.data().Name;
  var namebtn = document.createElement("button");
  namebtn.id = doc.id;
  namebtn.onclick = ViewProfile;
  namebtn.textContent = "View Profile";
  namebox.appendChild(namebtn);
});

     

 }

  async function ViewProfile(){
     window.open( '/' + this.id, '_self');
   }
   

  

</script>

<script>

  var uid = sessionStorage.getItem("uid");

  if(uid){
     console.log(uid);
    }
  else{ 
    window.open("/signin", "_self")}

  var gen = localStorage.getItem("Gen");

  function getColor(){

    if(gen == "theme1"){

      var color = "rgb(25,125,255)";

      document.body.id = "theme1";

      document.querySelector('#back').style.color = 'rgb(22,122,222)';

      }

    else{ var color = "rgb(255,195,195)";

        document.body.id = "theme2";

         document.querySelector('#back').style.color = 'rgb(222,190,190)';
        }
  }
  getColor();
  </script>
